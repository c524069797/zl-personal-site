# Python + Flask ä¼ä¸šçº§è®¸å¯è¯ç®¡ç†ç³»ç»Ÿ

## é¡¹ç›®æ¦‚è¿°

**Scutech Licenser** æ˜¯ä¸€ä¸ªä¼ä¸šçº§è½¯ä»¶è®¸å¯è¯ç®¡ç†å¹³å°ï¼Œç”¨äºŽå¤šäº§å“çº¿çš„è®¸å¯è¯ç­¾å‘ã€å®¡æ‰¹ã€è¿½è¸ªä¸Žå®¡è®¡ã€‚

---

## ä¸ºä»€ä¹ˆé€‰æ‹© Python + Flaskï¼Ÿ

### 1. Python çš„ä¼˜åŠ¿

| æŠ€æœ¯éœ€æ±‚ | Python è§£å†³æ–¹æ¡ˆ | ä¼˜åŠ¿ |
|---------|----------------|------|
| **åŠ å¯†ç­¾å** | `pycryptodome`, `m2crypto` | æˆç†Ÿçš„ RSA/AES åŠ å¯†åº“ï¼Œå®‰å…¨å¯é  |
| **æ•°æ®åº“æ“ä½œ** | `psycopg2` è¿žæŽ¥æ±  | é«˜æ€§èƒ½ PostgreSQL é©±åŠ¨ï¼Œæ”¯æŒæ¸¸æ ‡ã€COPY |
| **ä¼ä¸šè®¤è¯** | `python-ldap` | æ— ç¼å¯¹æŽ¥ AD/LDAP ä¼ä¸šèº«ä»½ç³»ç»Ÿ |
| **å®šæ—¶ä»»åŠ¡** | `APScheduler` | åŽå°è°ƒåº¦æ•°æ®å½’æ¡£ |
| **å¿«é€Ÿå¼€å‘** | è¯­æ³•ç®€æ´ | å¤æ‚ä¸šåŠ¡é€»è¾‘é«˜æ•ˆå®žçŽ° |

### 2. Flask çš„ä¼˜åŠ¿

- **è½»é‡çµæ´»**ï¼šä¸å¼ºåˆ¶ç»‘å®š ORMï¼Œå…è®¸è‡ªå®šä¹‰æ•°æ®åº“å°è£…å±‚
- **Blueprint æ¨¡å—åŒ–**ï¼š20+ ç‹¬ç«‹æ¨¡å—ï¼ˆuser/product/license/log/contract ç­‰ï¼‰æ¸…æ™°è§£è€¦
- **æ’ä»¶ç”Ÿæ€**ï¼š`Flask-Login` + `Flask-Session` + `Flask-Mail` å¿«é€Ÿé›†æˆä¼ä¸šåŠŸèƒ½

---

## ç³»ç»Ÿæ ¸å¿ƒäº®ç‚¹

### ðŸ” å®‰å…¨æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŒé‡è®¤è¯ï¼šæœ¬åœ°è´¦å· + LDAP/AD ä¼ä¸šèº«ä»½è®¤è¯           â”‚
â”‚  OTP äºŒæ¬¡éªŒè¯ï¼šTOTP åŠ¨æ€å£ä»¤ + å¤‡ç”¨ç                â”‚
â”‚  RSA éžå¯¹ç§°åŠ å¯†ï¼šç¦»çº¿è®¸å¯è¯ç­¾å‘ä¸ŽéªŒè¯               â”‚
â”‚  å‚æ•°åŒ– SQLï¼špsycopg2.sql é˜²æ³¨å…¥                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ðŸ“Š å®¡è®¡æ—¥å¿—ç³»ç»Ÿ

```python
# è£…é¥°å™¨æ¨¡å¼è‡ªåŠ¨è®°å½•æ‰€æœ‰ CRUD æ“ä½œ
@record_audit_logs
def create(cls, json_data):
    return insert(cls.table_name, json_data)
```

- è‡ªåŠ¨æ•èŽ·å˜æ›´å‰åŽå®Œæ•´æ•°æ®
- å¼‚å¸¸æ“ä½œä¹Ÿè®°å½•ï¼ˆæ ‡è®°å¤±è´¥çŠ¶æ€ï¼‰
- æ»¡è¶³ä¼ä¸šåˆè§„å®¡è®¡éœ€æ±‚

### ðŸ­ å·¥åŽ‚æ¨¡å¼å¤šäº§å“æ”¯æŒ

æ”¯æŒ DBackup/InfoSync/InfoStorage/CloudMigration ç­‰å¤šäº§å“çº¿ï¼š

```python
class RequestFactory:
    def store(self, request_data):
        product_uuid = request_data["product_uuid"]
        handler = self.product_map.get(product_uuid)
        return handler().save(request_data)
```

### ðŸ—„ï¸ PostgreSQL é«˜çº§ç‰¹æ€§åº”ç”¨

| ç‰¹æ€§ | ç”¨é€” |
|-----|------|
| **JSONB** | çµæ´»å­˜å‚¨æƒé™é…ç½®ã€è®¸å¯è¯æ‰©å±•å±žæ€§ |
| **æ•°ç»„ç±»åž‹** | å­˜å‚¨æ¨¡å—åˆ—è¡¨ã€ä¸»æœº UUID é›†åˆ |
| **UUID** | è·¨è¡¨æ¾è€¦åˆå…³è”ï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½² |
| **è¿žæŽ¥æ± ** | `ThreadedConnectionPool` é«˜å¹¶å‘å¤„ç† |

### â° è‡ªåŠ¨åŒ–è¿ç»´

```python
# å®šæ—¶å½’æ¡£ä»»åŠ¡ï¼ˆæ¯æœˆ 1 å·ï¼‰
@scheduler.scheduled_job('cron', day=1, hour=3)
def monthly_archive_job():
    manager = ArchiveManager(...)
    manager.run()  # å½’æ¡£ + GZIP åŽ‹ç¼© + æ¸…ç†æ—§æ•°æ®
```

---

## æŠ€æœ¯æ ˆæ€»ç»“

| å±‚æ¬¡ | æŠ€æœ¯ |
|-----|------|
| **åŽç«¯æ¡†æž¶** | Flask 1.0.2 |
| **æ•°æ®åº“** | PostgreSQL 10+ (psycopg2) |
| **åŠ å¯†** | pycryptodome, m2crypto (RSA) |
| **è®¤è¯** | Flask-Login, python-ldap, pyotp |
| **ä»»åŠ¡è°ƒåº¦** | APScheduler |
| **å‰ç«¯** | Vue.js 2.x |
| **éƒ¨ç½²** | Docker + docker-compose |

---

## ç®€åŽ†æè¿°å‚è€ƒ

> **ä¼ä¸šçº§è®¸å¯è¯ç®¡ç†å¹³å°** | Python, Flask, PostgreSQL, Vue.js
> 
> - åŸºäºŽ Flask Blueprint æž¶æž„è®¾è®¡ 20+ ä¸šåŠ¡æ¨¡å—ï¼Œå®žçŽ°å¤šäº§å“çº¿è®¸å¯è¯å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
> - é‡‡ç”¨è£…é¥°å™¨æ¨¡å¼å®žçŽ°è‡ªåŠ¨å®¡è®¡æ—¥å¿—ï¼Œè¿½è¸ªæ‰€æœ‰æ•°æ®å˜æ›´æ»¡è¶³åˆè§„è¦æ±‚
> - é›†æˆ LDAP/AD ä¼ä¸šè®¤è¯ + OTP äºŒæ¬¡éªŒè¯ï¼Œä¿éšœç³»ç»Ÿå®‰å…¨æ€§
> - ä½¿ç”¨ PostgreSQL JSONB/æ•°ç»„ç±»åž‹ä¼˜åŒ–çµæ´»é…ç½®å­˜å‚¨ï¼ŒUUID å®žçŽ°æ¾è€¦åˆå…³è”
> - åŸºäºŽ APScheduler å®žçŽ°å®šæ—¶æ•°æ®å½’æ¡£ä¸Žæ¸…ç†ï¼Œä¿éšœå¤§æ•°æ®é‡ä¸‹çš„ç³»ç»Ÿæ€§èƒ½
> - é‡‡ç”¨ RSA éžå¯¹ç§°åŠ å¯†å®žçŽ°ç¦»çº¿è®¸å¯è¯ç­¾å‘ä¸ŽéªŒè¯æœºåˆ¶

---

## æ ¸å¿ƒç»„ä»¶äº®ç‚¹ï¼ˆé¢è¯•è¯¦è§£ï¼‰

ä»¥ä¸‹ä¸ºç®€åŽ†ä¸­"é€šç”¨ç»„ä»¶åº“å»ºè®¾"çš„æŠ€æœ¯ç»†èŠ‚ï¼Œå¯åœ¨é¢è¯•ä¸­å±•å¼€è¯´æ˜Žã€‚

### äº®ç‚¹ä¸€ï¼šæ™ºèƒ½å®¹é‡è¾“å…¥ä½“ç³» (FormSpaceInput / SmartUnitInput)

**ä¸šåŠ¡èƒŒæ™¯**ï¼šç¾å¤‡è½¯ä»¶éœ€è¦å¤„ç† B åˆ° YB çº§åˆ«çš„å­˜å‚¨å®¹é‡é…ç½®ï¼ŒJS Number åœ¨ PB çº§ä»¥ä¸Šå­˜åœ¨ç²¾åº¦ä¸¢å¤±é—®é¢˜ã€‚

**æŠ€æœ¯å®žçŽ°**ï¼š
```javascript
// æ ¸å¿ƒç®—æ³•ï¼š9çº§å•ä½è‡ªåŠ¨æ¢ç®—ï¼ˆB â†’ KB â†’ MB â†’ GB â†’ TB â†’ PB â†’ EB â†’ ZB â†’ YBï¼‰
const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']

// æ˜¾ç¤ºå•ä½ä¸Žå­˜å‚¨æ•°å€¼åˆ†ç¦»
// å‰ç«¯æ˜¾ç¤ºï¼š1 TiB
// v-model ç»‘å®šå€¼ï¼š1099511627776 (Bytes)
```

**äº®ç‚¹ç‰¹æ€§**ï¼š
- å†…ç½® B è‡³ YB (9çº§) çš„è‡ªåŠ¨è¿›ä½æ¢ç®—ç®—æ³•
- è§£å†³ JS å¤„ç† PB çº§ä»¥ä¸Šæ•°å€¼æ—¶çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜ï¼ˆä½¿ç”¨ BigIntï¼‰
- æ”¯æŒè¾“å…¥ `1024GB` è‡ªåŠ¨è·³å˜ä¸º `1TB` çš„æ™ºèƒ½äº¤äº’
- å®žçŽ°"æ˜¾ç¤ºå•ä½"ä¸Ž"å­˜å‚¨æ•°å€¼"çš„åˆ†ç¦»ï¼Œæžå¤§é™ä½Žç”¨æˆ·å¿ƒæ™ºè´Ÿæ‹…

---

### äº®ç‚¹äºŒï¼šä¼ä¸šçº§åˆ†æ­¥å‘å¯¼å®¹å™¨ (WizardWrap)

**ä¸šåŠ¡èƒŒæ™¯**ï¼šå¤‡ä»½/æ¢å¤ä»»åŠ¡é…ç½®æ¶‰åŠå¤šæ­¥éª¤è¡¨å•ï¼Œéœ€è¦çµæ´»çš„æ­¥éª¤æŽ§åˆ¶å’Œæ ¡éªŒæœºåˆ¶ã€‚

**æž¶æž„è®¾è®¡**ï¼š
```
WizardWrap (çˆ¶å®¹å™¨)
  â”œâ”€â”€ provide: { registerCard, goNext, goBack }
  â”‚
  â”œâ”€â”€ WizardCard (å­æ­¥éª¤1)
  â”‚   â””â”€â”€ expose: validator()
  â”‚
  â”œâ”€â”€ WizardCard (å­æ­¥éª¤2)
  â”‚   â””â”€â”€ expose: validator()
  â”‚
  â””â”€â”€ WizardCard (å­æ­¥éª¤3)
      â””â”€â”€ expose: validator()
```

**æ ¸å¿ƒç‰¹æ€§**ï¼š
1. **æ¾è€¦åˆè®¾è®¡**ï¼šåŸºäºŽ Vue 3 Provide/Injectï¼Œå­ç»„ä»¶æ— éœ€æ„ŸçŸ¥çˆ¶å®¹å™¨å­˜åœ¨
2. **Promise æ‹¦æˆªé“¾**ï¼šç‚¹å‡»"ä¸‹ä¸€æ­¥"æ—¶åŠ¨æ€æ‰§è¡ŒæŽ¥å£æ ¡éªŒï¼ˆå¦‚é‡åæ£€æµ‹ï¼‰
3. **ä¸­é—´ä»¶æœºåˆ¶**ï¼šæ‰€æœ‰ validator ä¾æ¬¡é€šè¿‡åŽæ‰å…è®¸è¿›å…¥ä¸‹ä¸€æ­¥
4. **äº‹åŠ¡ä¸€è‡´æ€§**ï¼šå®Œç¾Žå¤„ç†å¤æ‚è¡¨å•çš„æ ¡éªŒé—®é¢˜

**ä»£ç ç¤ºä¾‹**ï¼š
```javascript
// å­ç»„ä»¶åªéœ€æš´éœ² validator é’©å­
defineExpose({
  validator: async () => {
    const isValid = await checkNameDuplicate(formData.name)
    return isValid
  }
})

// çˆ¶ç»„ä»¶è‡ªåŠ¨æ”¶é›†å¹¶æ‰§è¡Œæ‰€æœ‰æ ¡éªŒ
const goNext = async () => {
  const validators = cards.map(card => card.validator)
  const results = await Promise.all(validators.map(v => v()))
  if (results.every(Boolean)) {
    currentStep.value++
  }
}
```


